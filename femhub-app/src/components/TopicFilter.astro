---
export interface Props {
  currentTopic?: string;
  allTopics: string[];
}

const { currentTopic, allTopics } = Astro.props;

// 主题分组
const topicGroups = {
  '权利法律': ['教育权利', '法律权利', '政治参与', '身体自主'],
  '社会文化': ['职场平等', '媒体表征', '家庭角色'],
  '安全保护': ['性别暴力', '人身安全', '心理健康'],
  '学术理论': ['历史人物', '女性理论', '存在主义', '性别研究']
};

const availableGroups = Object.entries(topicGroups).map(([groupName, topics]) => ({
  name: groupName,
  topics: topics.filter(topic => allTopics.includes(topic))
})).filter(group => group.topics.length > 0);

const otherTopics = allTopics.filter(topic => 
  !Object.values(topicGroups).flat().includes(topic)
);
---

<div class="bg-white dark:bg-gray-800 rounded-lg shadow-sm border border-gray-200 dark:border-gray-700 p-6">
  <h3 class="text-lg font-semibold text-gray-900 dark:text-white mb-4">
    主题筛选
  </h3>

  <!-- Current Topic -->
  {currentTopic && (
    <div class="mb-6">
      <div class="text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
        当前主题
      </div>
      <div class="inline-flex items-center px-3 py-2 bg-purple-100 dark:bg-purple-900 text-purple-800 dark:text-purple-200 rounded-lg">
        <span class="font-medium">{currentTopic}</span>
        <a href="/topics" class="ml-2 text-purple-600 dark:text-purple-400 hover:text-purple-800 dark:hover:text-purple-200">
          <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
          </svg>
        </a>
      </div>
    </div>
  )}

  <!-- Topic Groups -->
  {availableGroups.map(group => (
    <div class="mb-6">
      <h4 class="text-sm font-medium text-gray-700 dark:text-gray-300 mb-3">
        {group.name}
      </h4>
      <div class="space-y-2">
        {group.topics.map(topic => (
          <a 
            href={`/topics/${encodeURIComponent(topic)}`}
            class={`block px-3 py-2 rounded-md text-sm transition-colors ${
              currentTopic === topic
                ? 'bg-purple-100 dark:bg-purple-900 text-purple-800 dark:text-purple-200 font-medium'
                : 'text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 hover:text-purple-600 dark:hover:text-purple-400'
            }`}
          >
            {topic}
          </a>
        ))}
      </div>
    </div>
  ))}

  <!-- Other Topics -->
  {otherTopics.length > 0 && (
    <div class="mb-6">
      <h4 class="text-sm font-medium text-gray-700 dark:text-gray-300 mb-3">
        其他主题
      </h4>
      <div class="space-y-2">
        {otherTopics.map(topic => (
          <a 
            href={`/topics/${encodeURIComponent(topic)}`}
            class={`block px-3 py-2 rounded-md text-sm transition-colors ${
              currentTopic === topic
                ? 'bg-purple-100 dark:bg-purple-900 text-purple-800 dark:text-purple-200 font-medium'
                : 'text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 hover:text-purple-600 dark:hover:text-purple-400'
            }`}
          >
            {topic}
          </a>
        ))}
      </div>
    </div>
  )}

  <!-- View All Topics -->
  <div class="pt-4 border-t border-gray-200 dark:border-gray-600">
    <a 
      href="/topics"
      class="block w-full px-4 py-2 text-center text-sm font-medium text-purple-600 dark:text-purple-400 hover:text-purple-800 dark:hover:text-purple-200 hover:bg-purple-50 dark:hover:bg-purple-900/20 rounded-md transition-colors"
    >
      查看所有主题
    </a>
  </div>
</div>