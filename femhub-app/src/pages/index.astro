---
import Layout from '../layouts/Layout.astro';
import BookCard from '../components/BookCard.astro';
import ArticleCard from '../components/ArticleCard.astro';
import VideoCard from '../components/VideoCard.astro';
import PodcastCard from '../components/PodcastCard.astro';
import PaperCard from '../components/PaperCard.astro';
import { getCollection } from 'astro:content';

// è·å–æ‰€æœ‰å†…å®¹
const books = await getCollection('books');
const articles = await getCollection('articles');
const videos = await getCollection('videos');
const podcasts = await getCollection('podcasts');
const papers = await getCollection('papers');

// åˆå¹¶æ‰€æœ‰å†…å®¹å¹¶æŒ‰å‘å¸ƒæ—¶é—´æ’åº
const allContent = [
  ...books.map(item => ({ ...item, contentType: 'book' as const })),
  ...articles.map(item => ({ ...item, contentType: 'article' as const })),
  ...videos.map(item => ({ ...item, contentType: 'video' as const })),
  ...podcasts.map(item => ({ ...item, contentType: 'podcast' as const })),
  ...papers.map(item => ({ ...item, contentType: 'paper' as const }))
].sort((a, b) => new Date(b.data.publishDate).getTime() - new Date(a.data.publishDate).getTime());

// è·å–ç¼–è¾‘æ¨èå†…å®¹ï¼ˆè´¨é‡åˆ†æ•°é«˜çš„ï¼‰
const editorsChoice = allContent
  .filter(item => item.data.qualityScore && item.data.qualityScore >= 9)
  .sort((a, b) => (b.data.qualityScore || 0) - (a.data.qualityScore || 0))
  .slice(0, 3);

// è·å–æœ€æ–°å†…å®¹ï¼ˆåˆ†ç±»å‹ï¼‰
const latestBooks = books.sort((a, b) => new Date(b.data.publishDate).getTime() - new Date(a.data.publishDate).getTime()).slice(0, 3);
const latestArticles = articles.sort((a, b) => new Date(b.data.publishDate).getTime() - new Date(a.data.publishDate).getTime()).slice(0, 4);
const latestVideos = videos.sort((a, b) => new Date(b.data.publishDate).getTime() - new Date(a.data.publishDate).getTime()).slice(0, 2);
const latestPodcasts = podcasts.sort((a, b) => new Date(b.data.publishDate).getTime() - new Date(a.data.publishDate).getTime()).slice(0, 2);
const latestPapers = papers.sort((a, b) => new Date(b.data.publishDate).getTime() - new Date(a.data.publishDate).getTime()).slice(0, 3);

// è·å–çƒ­é—¨ä¸»é¢˜
const allTopics = allContent.flatMap(item => item.data.topics);
const topicCounts = allTopics.reduce((acc, topic) => {
  acc[topic] = (acc[topic] || 0) + 1;
  return acc;
}, {} as Record<string, number>);
const popularTopics = Object.entries(topicCounts)
  .sort((a, b) => b[1] - a[1])
  .slice(0, 8)
  .map(([topic]) => topic);

// ä¸ºæ–‡ç« æ·»åŠ ç±»å‹æ ‡è®°
const enrichedArticles = articles.map(article => {
  let articleType: 'news' | 'blog' | 'research' | 'opinion' | 'analysis' = 'blog';
  if (article.data.title.includes('æŠ¥å‘Š') || article.data.title.includes('æ•°æ®')) {
    articleType = 'analysis';
  } else if (article.data.title.includes('ç°çŠ¶') || article.data.title.includes('MeToo')) {
    articleType = 'news';
  }
  return { ...article, articleType };
});
---

<Layout title="FemHub - å¥³æ€§ä¸»ä¹‰å†…å®¹èšåˆå¹³å°">
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-12">
    
    <!-- Hero Section -->
    <section class="relative overflow-hidden mb-20">
      <!-- Background decorative elements -->
      <div class="absolute inset-0 -z-10">
        <div class="absolute top-20 left-10 w-72 h-72 bg-purple-300 rounded-full mix-blend-multiply filter blur-xl opacity-20 animate-blob"></div>
        <div class="absolute top-40 right-10 w-72 h-72 bg-pink-300 rounded-full mix-blend-multiply filter blur-xl opacity-20 animate-blob animation-delay-2000"></div>
        <div class="absolute -bottom-8 left-20 w-72 h-72 bg-indigo-300 rounded-full mix-blend-multiply filter blur-xl opacity-20 animate-blob animation-delay-4000"></div>
      </div>

      <div class="relative text-center pt-16 pb-12">
        <div class="max-w-4xl mx-auto">
          <!-- Badge -->
          <div class="inline-flex items-center px-4 py-2 rounded-full bg-purple-100 dark:bg-purple-900 text-purple-800 dark:text-purple-200 text-sm font-medium mb-8">
            <span class="mr-2">ğŸŒŸ</span>
            æ±‡èšå…¨çƒä¼˜è´¨å¥³æ€§ä¸»ä¹‰å†…å®¹
          </div>

          <!-- Main heading -->
          <h1 class="text-5xl md:text-7xl font-bold text-gray-900 dark:text-white mb-8 leading-tight">
            å‘ç°
            <span class="text-transparent bg-clip-text bg-gradient-to-r from-purple-600 via-pink-600 to-indigo-600 relative">
              å¥³æ€§ä¸»ä¹‰
              <div class="absolute inset-0 bg-gradient-to-r from-purple-600 via-pink-600 to-indigo-600 opacity-20 blur-lg -z-10"></div>
            </span>
            çš„åŠ›é‡
          </h1>
          
          <!-- Subtitle -->
          <p class="text-xl md:text-2xl text-gray-600 dark:text-gray-300 mb-12 leading-relaxed max-w-3xl mx-auto">
            æ¢ç´¢ä¹¦ç±ã€æ–‡ç« ã€è§†é¢‘ã€æ’­å®¢å’Œå­¦æœ¯è®ºæ–‡<br/>
            æ·±å…¥äº†è§£æ€§åˆ«å¹³ç­‰çš„ç†è®ºä¸å®è·µï¼Œæ¨åŠ¨ç¤¾ä¼šè¿›æ­¥
          </p>

          <!-- Action buttons -->
          <div class="flex flex-col sm:flex-row gap-4 justify-center items-center mb-12">
            <a 
              href="/topics" 
              class="group inline-flex items-center justify-center px-8 py-4 text-lg font-semibold rounded-xl text-white bg-gradient-to-r from-purple-600 to-pink-600 hover:from-purple-700 hover:to-pink-700 shadow-lg hover:shadow-xl transform hover:-translate-y-1 transition-all duration-200"
            >
              å¼€å§‹æ¢ç´¢
              <svg class="ml-2 w-5 h-5 group-hover:translate-x-1 transition-transform" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 7l5 5m0 0l-5 5m5-5H6"></path>
              </svg>
            </a>
            <a 
              href="/about" 
              class="inline-flex items-center justify-center px-8 py-4 text-lg font-semibold rounded-xl border-2 border-gray-300 dark:border-gray-600 text-gray-700 dark:text-gray-300 hover:border-purple-500 dark:hover:border-purple-400 hover:text-purple-600 dark:hover:text-purple-400 transition-all duration-200"
            >
              äº†è§£é¡¹ç›®
            </a>
          </div>

          <!-- Key features -->
          <div class="grid grid-cols-1 md:grid-cols-3 gap-8 max-w-4xl mx-auto">
            <div class="text-center">
              <div class="w-16 h-16 bg-purple-100 dark:bg-purple-900 rounded-full flex items-center justify-center mx-auto mb-4">
                <span class="text-2xl">ğŸ“š</span>
              </div>
              <h3 class="font-semibold text-gray-900 dark:text-white mb-2">ä¸°å¯Œå†…å®¹</h3>
              <p class="text-gray-600 dark:text-gray-400 text-sm">æ¶µç›–ä¹¦ç±ã€æ–‡ç« ã€è§†é¢‘ç­‰å¤šç§å½¢å¼çš„ä¼˜è´¨å†…å®¹</p>
            </div>
            <div class="text-center">
              <div class="w-16 h-16 bg-pink-100 dark:bg-pink-900 rounded-full flex items-center justify-center mx-auto mb-4">
                <span class="text-2xl">ğŸ”</span>
              </div>
              <h3 class="font-semibold text-gray-900 dark:text-white mb-2">æ™ºèƒ½åˆ†ç±»</h3>
              <p class="text-gray-600 dark:text-gray-400 text-sm">æŒ‰ä¸»é¢˜å’Œç±»å‹ç²¾å‡†åˆ†ç±»ï¼Œå¿«é€Ÿæ‰¾åˆ°æ‰€éœ€å†…å®¹</p>
            </div>
            <div class="text-center">
              <div class="w-16 h-16 bg-indigo-100 dark:bg-indigo-900 rounded-full flex items-center justify-center mx-auto mb-4">
                <span class="text-2xl">ğŸŒ</span>
              </div>
              <h3 class="font-semibold text-gray-900 dark:text-white mb-2">å…¨çƒè§†è§’</h3>
              <p class="text-gray-600 dark:text-gray-400 text-sm">æ±‡èšå…¨çƒå¥³æ€§ä¸»ä¹‰å­¦è€…å’Œæ´»åŠ¨å®¶çš„è§‚ç‚¹</p>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- Editors' Choice Section -->
    {editorsChoice.length > 0 && (
      <section class="mb-20">
        <div class="flex items-center justify-between mb-10">
          <div>
            <h2 class="text-3xl md:text-4xl font-bold text-gray-900 dark:text-white mb-2">ç¼–è¾‘æ¨è</h2>
            <p class="text-lg text-gray-600 dark:text-gray-300">ç²¾å¿ƒæŒ‘é€‰çš„é«˜è´¨é‡å†…å®¹</p>
          </div>
          <div class="hidden md:flex items-center text-yellow-500">
            <span class="text-2xl mr-2">â­</span>
            <span class="text-sm font-medium text-gray-600 dark:text-gray-400">ç²¾é€‰å†…å®¹</span>
          </div>
        </div>
        
        <div class="grid grid-cols-1 md:grid-cols-3 gap-8">
          {editorsChoice.map(item => {
            if (item.contentType === 'book') {
              return (
                <div class="md:col-span-1">
                  <BookCard
                    title={item.data.title}
                    author={item.data.author}
                    description={item.data.description}
                    coverImage={item.data.coverImage}
                    publishDate={item.data.publishDate}
                    qualityScore={item.data.qualityScore}
                    slug={item.slug}
                    topics={item.data.topics}
                    isbn={item.data.isbn}
                  />
                </div>
              );
            } else if (item.contentType === 'video') {
              return (
                <div class="md:col-span-1">
                  <VideoCard
                    title={item.data.title}
                    author={item.data.author}
                    description={item.data.description}
                    thumbnail={item.data.thumbnail}
                    publishDate={item.data.publishDate}
                    duration={item.data.duration}
                    sourceUrl={item.data.sourceUrl}
                    slug={item.slug}
                    topics={item.data.topics}
                    qualityScore={item.data.qualityScore}
                  />
                </div>
              );
            } else if (item.contentType === 'podcast') {
              return (
                <div class="md:col-span-1">
                  <PodcastCard
                    title={item.data.title}
                    author={item.data.author}
                    description={item.data.description}
                    thumbnail={item.data.thumbnail}
                    publishDate={item.data.publishDate}
                    duration={item.data.duration}
                    sourceUrl={item.data.sourceUrl}
                    slug={item.slug}
                    topics={item.data.topics}
                    qualityScore={item.data.qualityScore}
                    episodeNumber={item.data.episodeNumber}
                  />
                </div>
              );
            } else if (item.contentType === 'paper') {
              return (
                <div class="md:col-span-1">
                  <PaperCard
                    title={item.data.title}
                    author={item.data.author}
                    description={item.data.description}
                    publishDate={item.data.publishDate}
                    qualityScore={item.data.qualityScore}
                    slug={item.slug}
                    topics={item.data.topics}
                    journal={item.data.journal}
                    doi={item.data.doi}
                    citationCount={item.data.citationCount}
                    paperType={item.data.paperType}
                  />
                </div>
              );
            } else {
              const enriched = enrichedArticles.find(a => a.slug === item.slug);
              return (
                <div class="md:col-span-1">
                  <ArticleCard
                    title={item.data.title}
                    author={item.data.author}
                    description={item.data.description}
                    featuredImage={item.data.featuredImage}
                    publishDate={item.data.publishDate}
                    readingTime={item.data.readingTime}
                    sourceUrl={item.data.sourceUrl}
                    slug={item.slug}
                    topics={item.data.topics}
                    qualityScore={item.data.qualityScore}
                    articleType={enriched?.articleType}
                  />
                </div>
              );
            }
          })}
        </div>
      </section>
    )}

    <!-- Latest Updates Section -->
    <section class="mb-20">
      <div class="mb-12">
        <h2 class="text-3xl md:text-4xl font-bold text-gray-900 dark:text-white mb-2">æœ€æ–°æ›´æ–°</h2>
        <p class="text-lg text-gray-600 dark:text-gray-300">æŒç»­æ›´æ–°çš„å¥³æ€§ä¸»ä¹‰å†…å®¹</p>
      </div>

      <!-- Latest Books -->
      {latestBooks.length > 0 && (
        <div class="mb-12">
          <h3 class="text-2xl font-semibold text-gray-900 dark:text-white mb-6 flex items-center">
            <span class="text-3xl mr-3">ğŸ“š</span>
            æœ€æ–°ä¹¦ç±
          </h3>
          <div class="grid grid-cols-1 lg:grid-cols-2 xl:grid-cols-3 gap-6">
            {latestBooks.map(book => (
              <BookCard
                title={book.data.title}
                author={book.data.author}
                description={book.data.description}
                coverImage={book.data.coverImage}
                publishDate={book.data.publishDate}
                qualityScore={book.data.qualityScore}
                slug={book.slug}
                topics={book.data.topics}
                isbn={book.data.isbn}
              />
            ))}
          </div>
        </div>
      )}

      <!-- Latest Articles -->
      {latestArticles.length > 0 && (
        <div class="mb-12">
          <h3 class="text-2xl font-semibold text-gray-900 dark:text-white mb-6 flex items-center">
            <span class="text-3xl mr-3">ğŸ“°</span>
            æœ€æ–°æ–‡ç« 
          </h3>
          <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
            {enrichedArticles.slice(0, 4).map(article => (
              <ArticleCard
                title={article.data.title}
                author={article.data.author}
                description={article.data.description}
                featuredImage={article.data.featuredImage}
                publishDate={article.data.publishDate}
                readingTime={article.data.readingTime}
                sourceUrl={article.data.sourceUrl}
                slug={article.slug}
                topics={article.data.topics}
                qualityScore={article.data.qualityScore}
                articleType={article.articleType}
              />
            ))}
          </div>
        </div>
      )}

      <!-- Latest Videos -->
      {latestVideos.length > 0 && (
        <div class="mb-12">
          <h3 class="text-2xl font-semibold text-gray-900 dark:text-white mb-6 flex items-center">
            <span class="text-3xl mr-3">ğŸ¥</span>
            æœ€æ–°è§†é¢‘
          </h3>
          <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
            {latestVideos.map(video => (
              <VideoCard
                title={video.data.title}
                author={video.data.author}
                description={video.data.description}
                thumbnail={video.data.thumbnail}
                publishDate={video.data.publishDate}
                duration={video.data.duration}
                sourceUrl={video.data.sourceUrl}
                slug={video.slug}
                topics={video.data.topics}
                qualityScore={video.data.qualityScore}
              />
            ))}
          </div>
        </div>
      )}

      <!-- Latest Podcasts -->
      {latestPodcasts.length > 0 && (
        <div class="mb-12">
          <h3 class="text-2xl font-semibold text-gray-900 dark:text-white mb-6 flex items-center">
            <span class="text-3xl mr-3">ğŸ§</span>
            æœ€æ–°æ’­å®¢
          </h3>
          <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
            {latestPodcasts.map(podcast => (
              <PodcastCard
                title={podcast.data.title}
                author={podcast.data.author}
                description={podcast.data.description}
                thumbnail={podcast.data.thumbnail}
                publishDate={podcast.data.publishDate}
                duration={podcast.data.duration}
                sourceUrl={podcast.data.sourceUrl}
                slug={podcast.slug}
                topics={podcast.data.topics}
                qualityScore={podcast.data.qualityScore}
                episodeNumber={podcast.data.episodeNumber}
              />
            ))}
          </div>
        </div>
      )}

      <!-- Latest Papers -->
      {latestPapers.length > 0 && (
        <div class="mb-12">
          <h3 class="text-2xl font-semibold text-gray-900 dark:text-white mb-6 flex items-center">
            <span class="text-3xl mr-3">ğŸ“„</span>
            æœ€æ–°è®ºæ–‡
          </h3>
          <div class="grid grid-cols-1 lg:grid-cols-2 xl:grid-cols-3 gap-6">
            {latestPapers.map(paper => (
              <PaperCard
                title={paper.data.title}
                author={paper.data.author}
                description={paper.data.description}
                publishDate={paper.data.publishDate}
                qualityScore={paper.data.qualityScore}
                slug={paper.slug}
                topics={paper.data.topics}
                journal={paper.data.journal}
                doi={paper.data.doi}
                citationCount={paper.data.citationCount}
                paperType={paper.data.paperType}
              />
            ))}
          </div>
        </div>
      )}
    </section>

    <!-- Featured Topics -->
    <section class="mb-20">
      <div class="text-center mb-12">
        <h2 class="text-3xl md:text-4xl font-bold text-gray-900 dark:text-white mb-6">çƒ­é—¨ä¸»é¢˜</h2>
        <p class="text-xl text-gray-600 dark:text-gray-300 max-w-2xl mx-auto">æ¢ç´¢æœ€å—å…³æ³¨çš„å¥³æ€§ä¸»ä¹‰è¯é¢˜ï¼Œæ·±å…¥äº†è§£å„ä¸ªé¢†åŸŸçš„å‘å±•ç°çŠ¶</p>
      </div>
      <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
        {popularTopics.slice(0, 8).map((topic, index) => {
          const colors = [
            'from-purple-500 to-pink-500',
            'from-pink-500 to-rose-500', 
            'from-indigo-500 to-purple-500',
            'from-emerald-500 to-teal-500',
            'from-orange-500 to-red-500',
            'from-blue-500 to-indigo-500',
            'from-teal-500 to-green-500',
            'from-violet-500 to-purple-500'
          ];
          const bgGradient = colors[index % colors.length];
          
          return (
            <a 
              href={`/topics/${encodeURIComponent(topic)}`}
              class="group relative overflow-hidden p-8 bg-white dark:bg-gray-800 rounded-2xl shadow-sm border border-gray-200 dark:border-gray-700 hover:shadow-xl hover:-translate-y-2 transition-all duration-300 text-center"
            >
              <!-- Background gradient on hover -->
              <div class={`absolute inset-0 bg-gradient-to-br ${bgGradient} opacity-0 group-hover:opacity-5 transition-opacity duration-300`}></div>
              
              <!-- Icon with background -->
              <div class={`relative inline-flex items-center justify-center w-20 h-20 rounded-2xl bg-gradient-to-br ${bgGradient} text-white mb-6 group-hover:scale-110 transition-transform duration-300`}>
                <span class="text-3xl">
                  {topic === 'èŒåœºå¹³ç­‰' && 'ğŸ’¼'}
                  {topic === 'èº«ä½“è‡ªä¸»' && 'ğŸŒ¸'}
                  {topic === 'æ•™è‚²æƒåˆ©' && 'ğŸ“š'}
                  {topic === 'æ”¿æ²»å‚ä¸' && 'ğŸ—³ï¸'}
                  {topic === 'å®¶åº­è§’è‰²' && 'ğŸ‘¨â€ğŸ‘©â€ğŸ‘§â€ğŸ‘¦'}
                  {topic === 'æ€§åˆ«æš´åŠ›' && 'ğŸ›¡ï¸'}
                  {topic === 'åª’ä½“è¡¨å¾' && 'ğŸ“º'}
                  {topic === 'å†å²äººç‰©' && 'ğŸ‘©â€ğŸ“'}
                  {!['èŒåœºå¹³ç­‰', 'èº«ä½“è‡ªä¸»', 'æ•™è‚²æƒåˆ©', 'æ”¿æ²»å‚ä¸', 'å®¶åº­è§’è‰²', 'æ€§åˆ«æš´åŠ›', 'åª’ä½“è¡¨å¾', 'å†å²äººç‰©'].includes(topic) && 'ğŸ·ï¸'}
                </span>
              </div>
              
              <!-- Content -->
              <div class="relative">
                <h3 class="text-xl font-bold text-gray-900 dark:text-white mb-3 group-hover:text-transparent group-hover:bg-clip-text group-hover:bg-gradient-to-r group-hover:from-purple-600 group-hover:to-pink-600 transition-all duration-300">
                  {topic}
                </h3>
                <p class="text-gray-600 dark:text-gray-400 mb-4">
                  {topicCounts[topic]} ä¸ªç²¾é€‰å†…å®¹
                </p>
                
                <!-- Progress bar -->
                <div class="w-full bg-gray-200 dark:bg-gray-700 rounded-full h-2">
                  <div class={`h-2 rounded-full bg-gradient-to-r ${bgGradient} transition-all duration-500`} 
                       style={`width: ${Math.min(100, (topicCounts[topic] / Math.max(...Object.values(topicCounts))) * 100)}%`}>
                  </div>
                </div>
              </div>
              
              <!-- Arrow icon -->
              <div class="absolute top-4 right-4 opacity-0 group-hover:opacity-100 transform translate-x-2 group-hover:translate-x-0 transition-all duration-300">
                <svg class="w-6 h-6 text-gray-400 group-hover:text-purple-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 8l4 4m0 0l-4 4m4-4H3"></path>
                </svg>
              </div>
            </a>
          );
        })}
      </div>
      
      <!-- View all topics button -->
      <div class="text-center mt-12">
        <a 
          href="/topics"
          class="inline-flex items-center px-8 py-4 bg-gradient-to-r from-gray-800 to-gray-900 dark:from-gray-700 dark:to-gray-800 text-white font-semibold rounded-xl hover:shadow-lg hover:-translate-y-1 transition-all duration-200"
        >
          æŸ¥çœ‹æ‰€æœ‰ä¸»é¢˜
          <svg class="ml-2 w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 7l5 5m0 0l-5 5m5-5H6"></path>
          </svg>
        </a>
      </div>
    </section>


    <!-- Call to Action -->
    <section class="text-center py-16 bg-gradient-to-r from-purple-600 to-pink-600 rounded-2xl text-white">
      <div class="max-w-2xl mx-auto px-6">
        <h2 class="text-3xl font-bold mb-4">
          ä¸€èµ·æ¨åŠ¨æ€§åˆ«å¹³ç­‰äº‹ä¸š
        </h2>
        <p class="text-xl mb-8 opacity-90">
          åŠ å…¥æˆ‘ä»¬çš„ç¤¾åŒºï¼Œåˆ†äº«ä½ çš„è§è§£ï¼Œå‘ç°æ›´å¤šä¼˜è´¨å†…å®¹
        </p>
        <div class="flex flex-col sm:flex-row gap-4 justify-center">
          <a 
            href="/contribute" 
            class="inline-flex items-center justify-center px-8 py-3 border border-white/30 text-base font-medium rounded-md text-white bg-white/10 hover:bg-white/20 transition-colors backdrop-blur"
          >
            è´¡çŒ®å†…å®¹
          </a>
          <a 
            href="/about" 
            class="inline-flex items-center justify-center px-8 py-3 border border-white text-base font-medium rounded-md text-purple-600 bg-white hover:bg-gray-50 transition-colors"
          >
            äº†è§£æ›´å¤š
          </a>
        </div>
      </div>
    </section>
  </div>
</Layout>
