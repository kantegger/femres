---
import Layout from '../layouts/Layout.astro';
import BookCard from '../components/BookCard.astro';
import ArticleCard from '../components/ArticleCard.astro';
import VideoCard from '../components/VideoCard.astro';
import PodcastCard from '../components/PodcastCard.astro';
import PaperCard from '../components/PaperCard.astro';
import { getCollection } from 'astro:content';

// 获取所有内容
const books = await getCollection('books');
const articles = await getCollection('articles');
const videos = await getCollection('videos');
const podcasts = await getCollection('podcasts');
const papers = await getCollection('papers');

// 合并所有内容并按发布时间排序
const allContent = [
  ...books.map(item => ({ ...item, contentType: 'book' as const })),
  ...articles.map(item => ({ ...item, contentType: 'article' as const })),
  ...videos.map(item => ({ ...item, contentType: 'video' as const })),
  ...podcasts.map(item => ({ ...item, contentType: 'podcast' as const })),
  ...papers.map(item => ({ ...item, contentType: 'paper' as const }))
].sort((a, b) => new Date(b.data.publishDate).getTime() - new Date(a.data.publishDate).getTime());

// 获取编辑推荐内容（质量分数高的）
const editorsChoice = allContent
  .filter(item => item.data.qualityScore && item.data.qualityScore >= 9)
  .sort((a, b) => (b.data.qualityScore || 0) - (a.data.qualityScore || 0))
  .slice(0, 3);

// 获取最新内容（分类型）
const latestBooks = books.sort((a, b) => new Date(b.data.publishDate).getTime() - new Date(a.data.publishDate).getTime()).slice(0, 3);
const latestArticles = articles.sort((a, b) => new Date(b.data.publishDate).getTime() - new Date(a.data.publishDate).getTime()).slice(0, 4);
const latestVideos = videos.sort((a, b) => new Date(b.data.publishDate).getTime() - new Date(a.data.publishDate).getTime()).slice(0, 2);
const latestPodcasts = podcasts.sort((a, b) => new Date(b.data.publishDate).getTime() - new Date(a.data.publishDate).getTime()).slice(0, 2);
const latestPapers = papers.sort((a, b) => new Date(b.data.publishDate).getTime() - new Date(a.data.publishDate).getTime()).slice(0, 3);

// 获取热门主题
const allTopics = allContent.flatMap(item => item.data.topics);
const topicCounts = allTopics.reduce((acc, topic) => {
  acc[topic] = (acc[topic] || 0) + 1;
  return acc;
}, {} as Record<string, number>);
const popularTopics = Object.entries(topicCounts)
  .sort((a, b) => b[1] - a[1])
  .slice(0, 8)
  .map(([topic]) => topic);

// 为文章添加类型标记
const enrichedArticles = articles.map(article => {
  let articleType: 'news' | 'blog' | 'research' | 'opinion' | 'analysis' = 'blog';
  if (article.data.title.includes('报告') || article.data.title.includes('数据')) {
    articleType = 'analysis';
  } else if (article.data.title.includes('现状') || article.data.title.includes('MeToo')) {
    articleType = 'news';
  }
  return { ...article, articleType };
});
---

<Layout title="FemHub - 女性主义内容聚合平台">
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-12">
    
    <!-- Hero Section -->
    <section class="relative overflow-hidden mb-20">
      <!-- Background decorative elements -->
      <div class="absolute inset-0 -z-10">
        <div class="absolute top-20 left-10 w-72 h-72 bg-purple-300 rounded-full mix-blend-multiply filter blur-xl opacity-20 animate-blob"></div>
        <div class="absolute top-40 right-10 w-72 h-72 bg-pink-300 rounded-full mix-blend-multiply filter blur-xl opacity-20 animate-blob animation-delay-2000"></div>
        <div class="absolute -bottom-8 left-20 w-72 h-72 bg-indigo-300 rounded-full mix-blend-multiply filter blur-xl opacity-20 animate-blob animation-delay-4000"></div>
      </div>

      <div class="relative text-center pt-16 pb-12">
        <div class="max-w-4xl mx-auto">
          <!-- Badge -->
          <div class="inline-flex items-center px-4 py-2 rounded-full bg-purple-100 dark:bg-purple-900 text-purple-800 dark:text-purple-200 text-sm font-medium mb-8">
            <span class="mr-2">🌟</span>
            汇聚全球优质女性主义内容
          </div>

          <!-- Main heading -->
          <h1 class="text-5xl md:text-7xl font-bold text-gray-900 dark:text-white mb-8 leading-tight">
            发现
            <span class="text-transparent bg-clip-text bg-gradient-to-r from-purple-600 via-pink-600 to-indigo-600 relative">
              女性主义
              <div class="absolute inset-0 bg-gradient-to-r from-purple-600 via-pink-600 to-indigo-600 opacity-20 blur-lg -z-10"></div>
            </span>
            的力量
          </h1>
          
          <!-- Subtitle -->
          <p class="text-xl md:text-2xl text-gray-600 dark:text-gray-300 mb-12 leading-relaxed max-w-3xl mx-auto">
            探索书籍、文章、视频、播客和学术论文<br/>
            深入了解性别平等的理论与实践，推动社会进步
          </p>

          <!-- Action buttons -->
          <div class="flex flex-col sm:flex-row gap-4 justify-center items-center mb-12">
            <a 
              href="/topics" 
              class="group inline-flex items-center justify-center px-8 py-4 text-lg font-semibold rounded-xl text-white bg-gradient-to-r from-purple-600 to-pink-600 hover:from-purple-700 hover:to-pink-700 shadow-lg hover:shadow-xl transform hover:-translate-y-1 transition-all duration-200"
            >
              开始探索
              <svg class="ml-2 w-5 h-5 group-hover:translate-x-1 transition-transform" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 7l5 5m0 0l-5 5m5-5H6"></path>
              </svg>
            </a>
            <a 
              href="/about" 
              class="inline-flex items-center justify-center px-8 py-4 text-lg font-semibold rounded-xl border-2 border-gray-300 dark:border-gray-600 text-gray-700 dark:text-gray-300 hover:border-purple-500 dark:hover:border-purple-400 hover:text-purple-600 dark:hover:text-purple-400 transition-all duration-200"
            >
              了解项目
            </a>
          </div>

          <!-- Key features -->
          <div class="grid grid-cols-1 md:grid-cols-3 gap-8 max-w-4xl mx-auto">
            <div class="text-center">
              <div class="w-16 h-16 bg-purple-100 dark:bg-purple-900 rounded-full flex items-center justify-center mx-auto mb-4">
                <span class="text-2xl">📚</span>
              </div>
              <h3 class="font-semibold text-gray-900 dark:text-white mb-2">丰富内容</h3>
              <p class="text-gray-600 dark:text-gray-400 text-sm">涵盖书籍、文章、视频等多种形式的优质内容</p>
            </div>
            <div class="text-center">
              <div class="w-16 h-16 bg-pink-100 dark:bg-pink-900 rounded-full flex items-center justify-center mx-auto mb-4">
                <span class="text-2xl">🔍</span>
              </div>
              <h3 class="font-semibold text-gray-900 dark:text-white mb-2">智能分类</h3>
              <p class="text-gray-600 dark:text-gray-400 text-sm">按主题和类型精准分类，快速找到所需内容</p>
            </div>
            <div class="text-center">
              <div class="w-16 h-16 bg-indigo-100 dark:bg-indigo-900 rounded-full flex items-center justify-center mx-auto mb-4">
                <span class="text-2xl">🌍</span>
              </div>
              <h3 class="font-semibold text-gray-900 dark:text-white mb-2">全球视角</h3>
              <p class="text-gray-600 dark:text-gray-400 text-sm">汇聚全球女性主义学者和活动家的观点</p>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- Editors' Choice Section -->
    {editorsChoice.length > 0 && (
      <section class="mb-20">
        <div class="flex items-center justify-between mb-10">
          <div>
            <h2 class="text-3xl md:text-4xl font-bold text-gray-900 dark:text-white mb-2">编辑推荐</h2>
            <p class="text-lg text-gray-600 dark:text-gray-300">精心挑选的高质量内容</p>
          </div>
          <div class="hidden md:flex items-center text-yellow-500">
            <span class="text-2xl mr-2">⭐</span>
            <span class="text-sm font-medium text-gray-600 dark:text-gray-400">精选内容</span>
          </div>
        </div>
        
        <div class="grid grid-cols-1 md:grid-cols-3 gap-8">
          {editorsChoice.map(item => {
            if (item.contentType === 'book') {
              return (
                <div class="md:col-span-1">
                  <BookCard
                    title={item.data.title}
                    author={item.data.author}
                    description={item.data.description}
                    coverImage={item.data.coverImage}
                    publishDate={item.data.publishDate}
                    qualityScore={item.data.qualityScore}
                    slug={item.slug}
                    topics={item.data.topics}
                    isbn={item.data.isbn}
                  />
                </div>
              );
            } else if (item.contentType === 'video') {
              return (
                <div class="md:col-span-1">
                  <VideoCard
                    title={item.data.title}
                    author={item.data.author}
                    description={item.data.description}
                    thumbnail={item.data.thumbnail}
                    publishDate={item.data.publishDate}
                    duration={item.data.duration}
                    sourceUrl={item.data.sourceUrl}
                    slug={item.slug}
                    topics={item.data.topics}
                    qualityScore={item.data.qualityScore}
                  />
                </div>
              );
            } else if (item.contentType === 'podcast') {
              return (
                <div class="md:col-span-1">
                  <PodcastCard
                    title={item.data.title}
                    author={item.data.author}
                    description={item.data.description}
                    thumbnail={item.data.thumbnail}
                    publishDate={item.data.publishDate}
                    duration={item.data.duration}
                    sourceUrl={item.data.sourceUrl}
                    slug={item.slug}
                    topics={item.data.topics}
                    qualityScore={item.data.qualityScore}
                    episodeNumber={item.data.episodeNumber}
                  />
                </div>
              );
            } else if (item.contentType === 'paper') {
              return (
                <div class="md:col-span-1">
                  <PaperCard
                    title={item.data.title}
                    author={item.data.author}
                    description={item.data.description}
                    publishDate={item.data.publishDate}
                    qualityScore={item.data.qualityScore}
                    slug={item.slug}
                    topics={item.data.topics}
                    journal={item.data.journal}
                    doi={item.data.doi}
                    citationCount={item.data.citationCount}
                    paperType={item.data.paperType}
                  />
                </div>
              );
            } else {
              const enriched = enrichedArticles.find(a => a.slug === item.slug);
              return (
                <div class="md:col-span-1">
                  <ArticleCard
                    title={item.data.title}
                    author={item.data.author}
                    description={item.data.description}
                    featuredImage={item.data.featuredImage}
                    publishDate={item.data.publishDate}
                    readingTime={item.data.readingTime}
                    sourceUrl={item.data.sourceUrl}
                    slug={item.slug}
                    topics={item.data.topics}
                    qualityScore={item.data.qualityScore}
                    articleType={enriched?.articleType}
                  />
                </div>
              );
            }
          })}
        </div>
      </section>
    )}

    <!-- Latest Updates Section -->
    <section class="mb-20">
      <div class="mb-12">
        <h2 class="text-3xl md:text-4xl font-bold text-gray-900 dark:text-white mb-2">最新更新</h2>
        <p class="text-lg text-gray-600 dark:text-gray-300">持续更新的女性主义内容</p>
      </div>

      <!-- Latest Books -->
      {latestBooks.length > 0 && (
        <div class="mb-12">
          <h3 class="text-2xl font-semibold text-gray-900 dark:text-white mb-6 flex items-center">
            <span class="text-3xl mr-3">📚</span>
            最新书籍
          </h3>
          <div class="grid grid-cols-1 lg:grid-cols-2 xl:grid-cols-3 gap-6">
            {latestBooks.map(book => (
              <BookCard
                title={book.data.title}
                author={book.data.author}
                description={book.data.description}
                coverImage={book.data.coverImage}
                publishDate={book.data.publishDate}
                qualityScore={book.data.qualityScore}
                slug={book.slug}
                topics={book.data.topics}
                isbn={book.data.isbn}
              />
            ))}
          </div>
        </div>
      )}

      <!-- Latest Articles -->
      {latestArticles.length > 0 && (
        <div class="mb-12">
          <h3 class="text-2xl font-semibold text-gray-900 dark:text-white mb-6 flex items-center">
            <span class="text-3xl mr-3">📰</span>
            最新文章
          </h3>
          <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
            {enrichedArticles.slice(0, 4).map(article => (
              <ArticleCard
                title={article.data.title}
                author={article.data.author}
                description={article.data.description}
                featuredImage={article.data.featuredImage}
                publishDate={article.data.publishDate}
                readingTime={article.data.readingTime}
                sourceUrl={article.data.sourceUrl}
                slug={article.slug}
                topics={article.data.topics}
                qualityScore={article.data.qualityScore}
                articleType={article.articleType}
              />
            ))}
          </div>
        </div>
      )}

      <!-- Latest Videos -->
      {latestVideos.length > 0 && (
        <div class="mb-12">
          <h3 class="text-2xl font-semibold text-gray-900 dark:text-white mb-6 flex items-center">
            <span class="text-3xl mr-3">🎥</span>
            最新视频
          </h3>
          <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
            {latestVideos.map(video => (
              <VideoCard
                title={video.data.title}
                author={video.data.author}
                description={video.data.description}
                thumbnail={video.data.thumbnail}
                publishDate={video.data.publishDate}
                duration={video.data.duration}
                sourceUrl={video.data.sourceUrl}
                slug={video.slug}
                topics={video.data.topics}
                qualityScore={video.data.qualityScore}
              />
            ))}
          </div>
        </div>
      )}

      <!-- Latest Podcasts -->
      {latestPodcasts.length > 0 && (
        <div class="mb-12">
          <h3 class="text-2xl font-semibold text-gray-900 dark:text-white mb-6 flex items-center">
            <span class="text-3xl mr-3">🎧</span>
            最新播客
          </h3>
          <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
            {latestPodcasts.map(podcast => (
              <PodcastCard
                title={podcast.data.title}
                author={podcast.data.author}
                description={podcast.data.description}
                thumbnail={podcast.data.thumbnail}
                publishDate={podcast.data.publishDate}
                duration={podcast.data.duration}
                sourceUrl={podcast.data.sourceUrl}
                slug={podcast.slug}
                topics={podcast.data.topics}
                qualityScore={podcast.data.qualityScore}
                episodeNumber={podcast.data.episodeNumber}
              />
            ))}
          </div>
        </div>
      )}

      <!-- Latest Papers -->
      {latestPapers.length > 0 && (
        <div class="mb-12">
          <h3 class="text-2xl font-semibold text-gray-900 dark:text-white mb-6 flex items-center">
            <span class="text-3xl mr-3">📄</span>
            最新论文
          </h3>
          <div class="grid grid-cols-1 lg:grid-cols-2 xl:grid-cols-3 gap-6">
            {latestPapers.map(paper => (
              <PaperCard
                title={paper.data.title}
                author={paper.data.author}
                description={paper.data.description}
                publishDate={paper.data.publishDate}
                qualityScore={paper.data.qualityScore}
                slug={paper.slug}
                topics={paper.data.topics}
                journal={paper.data.journal}
                doi={paper.data.doi}
                citationCount={paper.data.citationCount}
                paperType={paper.data.paperType}
              />
            ))}
          </div>
        </div>
      )}
    </section>

    <!-- Featured Topics -->
    <section class="mb-20">
      <div class="text-center mb-12">
        <h2 class="text-3xl md:text-4xl font-bold text-gray-900 dark:text-white mb-6">热门主题</h2>
        <p class="text-xl text-gray-600 dark:text-gray-300 max-w-2xl mx-auto">探索最受关注的女性主义话题，深入了解各个领域的发展现状</p>
      </div>
      <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
        {popularTopics.slice(0, 8).map((topic, index) => {
          const colors = [
            'from-purple-500 to-pink-500',
            'from-pink-500 to-rose-500', 
            'from-indigo-500 to-purple-500',
            'from-emerald-500 to-teal-500',
            'from-orange-500 to-red-500',
            'from-blue-500 to-indigo-500',
            'from-teal-500 to-green-500',
            'from-violet-500 to-purple-500'
          ];
          const bgGradient = colors[index % colors.length];
          
          return (
            <a 
              href={`/topics/${encodeURIComponent(topic)}`}
              class="group relative overflow-hidden p-8 bg-white dark:bg-gray-800 rounded-2xl shadow-sm border border-gray-200 dark:border-gray-700 hover:shadow-xl hover:-translate-y-2 transition-all duration-300 text-center"
            >
              <!-- Background gradient on hover -->
              <div class={`absolute inset-0 bg-gradient-to-br ${bgGradient} opacity-0 group-hover:opacity-5 transition-opacity duration-300`}></div>
              
              <!-- Icon with background -->
              <div class={`relative inline-flex items-center justify-center w-20 h-20 rounded-2xl bg-gradient-to-br ${bgGradient} text-white mb-6 group-hover:scale-110 transition-transform duration-300`}>
                <span class="text-3xl">
                  {topic === '职场平等' && '💼'}
                  {topic === '身体自主' && '🌸'}
                  {topic === '教育权利' && '📚'}
                  {topic === '政治参与' && '🗳️'}
                  {topic === '家庭角色' && '👨‍👩‍👧‍👦'}
                  {topic === '性别暴力' && '🛡️'}
                  {topic === '媒体表征' && '📺'}
                  {topic === '历史人物' && '👩‍🎓'}
                  {!['职场平等', '身体自主', '教育权利', '政治参与', '家庭角色', '性别暴力', '媒体表征', '历史人物'].includes(topic) && '🏷️'}
                </span>
              </div>
              
              <!-- Content -->
              <div class="relative">
                <h3 class="text-xl font-bold text-gray-900 dark:text-white mb-3 group-hover:text-transparent group-hover:bg-clip-text group-hover:bg-gradient-to-r group-hover:from-purple-600 group-hover:to-pink-600 transition-all duration-300">
                  {topic}
                </h3>
                <p class="text-gray-600 dark:text-gray-400 mb-4">
                  {topicCounts[topic]} 个精选内容
                </p>
                
                <!-- Progress bar -->
                <div class="w-full bg-gray-200 dark:bg-gray-700 rounded-full h-2">
                  <div class={`h-2 rounded-full bg-gradient-to-r ${bgGradient} transition-all duration-500`} 
                       style={`width: ${Math.min(100, (topicCounts[topic] / Math.max(...Object.values(topicCounts))) * 100)}%`}>
                  </div>
                </div>
              </div>
              
              <!-- Arrow icon -->
              <div class="absolute top-4 right-4 opacity-0 group-hover:opacity-100 transform translate-x-2 group-hover:translate-x-0 transition-all duration-300">
                <svg class="w-6 h-6 text-gray-400 group-hover:text-purple-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 8l4 4m0 0l-4 4m4-4H3"></path>
                </svg>
              </div>
            </a>
          );
        })}
      </div>
      
      <!-- View all topics button -->
      <div class="text-center mt-12">
        <a 
          href="/topics"
          class="inline-flex items-center px-8 py-4 bg-gradient-to-r from-gray-800 to-gray-900 dark:from-gray-700 dark:to-gray-800 text-white font-semibold rounded-xl hover:shadow-lg hover:-translate-y-1 transition-all duration-200"
        >
          查看所有主题
          <svg class="ml-2 w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 7l5 5m0 0l-5 5m5-5H6"></path>
          </svg>
        </a>
      </div>
    </section>


    <!-- Call to Action -->
    <section class="text-center py-16 bg-gradient-to-r from-purple-600 to-pink-600 rounded-2xl text-white">
      <div class="max-w-2xl mx-auto px-6">
        <h2 class="text-3xl font-bold mb-4">
          一起推动性别平等事业
        </h2>
        <p class="text-xl mb-8 opacity-90">
          加入我们的社区，分享你的见解，发现更多优质内容
        </p>
        <div class="flex flex-col sm:flex-row gap-4 justify-center">
          <a 
            href="/contribute" 
            class="inline-flex items-center justify-center px-8 py-3 border border-white/30 text-base font-medium rounded-md text-white bg-white/10 hover:bg-white/20 transition-colors backdrop-blur"
          >
            贡献内容
          </a>
          <a 
            href="/about" 
            class="inline-flex items-center justify-center px-8 py-3 border border-white text-base font-medium rounded-md text-purple-600 bg-white hover:bg-gray-50 transition-colors"
          >
            了解更多
          </a>
        </div>
      </div>
    </section>
  </div>
</Layout>
