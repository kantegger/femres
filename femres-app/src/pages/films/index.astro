---
import { getCollection } from 'astro:content';
import Layout from '../../layouts/Layout.astro';
import FilmCard from '../../components/FilmCard.astro';

const films = await getCollection('films');
const publishedFilms = films.filter(film => film.data.status === 'published');

// æŒ‰å‘å¸ƒæ—¥æœŸæ’åº
const sortedFilms = publishedFilms.sort((a, b) => {
  return new Date(b.data.releaseDate).getTime() - new Date(a.data.releaseDate).getTime();
});

// è·å–æ‰€æœ‰ä¸»é¢˜æ ‡ç­¾
const allTopics = [...new Set(publishedFilms.flatMap(film => film.data.topics))].sort();

// è·å–æ‰€æœ‰å›½å®¶/åœ°åŒº
const allCountries = [...new Set(publishedFilms.map(film => film.data.country))].sort();

// è·å–æ‰€æœ‰ç±»å‹
const allGenres = [...new Set(publishedFilms.flatMap(film => film.data.genre || []))].sort();

// åˆ†é¡µè®¾ç½®
const FILMS_PER_PAGE = 12;
const totalFilms = publishedFilms.length;
const totalPages = Math.ceil(totalFilms / FILMS_PER_PAGE);

// è·å–å½“å‰é¡µç  (ä»URLå‚æ•°è·å–ï¼Œé»˜è®¤ä¸º1)
const currentPage = Number(Astro.url.searchParams.get('page') || '1');
const validPage = Math.max(1, Math.min(currentPage, totalPages));

// è®¡ç®—å½“å‰é¡µçš„ç”µå½±
const startIndex = (validPage - 1) * FILMS_PER_PAGE;
const endIndex = startIndex + FILMS_PER_PAGE;
const currentPageFilms = sortedFilms.slice(startIndex, endIndex);

// ç”Ÿæˆé¡µç æ•°ç»„
const pageNumbers = Array.from({ length: totalPages }, (_, i) => i + 1);

// ç”Ÿæˆä¸­é—´é¡µç æ•°ç»„
const middlePages = pageNumbers.filter(num => 
  num !== 1 && 
  num !== totalPages && 
  Math.abs(num - validPage) <= 1
);
---

<Layout 
  title="ç”µå½± - FemRes"
  description="ç²¾é€‰å¥³æ€§ä¸»ä¹‰ç›¸å…³ç”µå½±ï¼Œé€šè¿‡å½±åƒæ¢ç´¢æ€§åˆ«è®®é¢˜ã€å¥³æ€§æ•…äº‹ä¸ç¤¾ä¼šæ‰¹åˆ¤ï¼Œä¸ºè§‚å½±æä¾›å¤šå…ƒè§†è§’ã€‚"
>
  <div class="min-h-screen bg-gray-50 dark:bg-gray-900">
    <!-- Header -->
    <div class="bg-gradient-to-r from-purple-600 to-pink-600 text-white">
      <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-16">
        <div class="text-center">
          <h1 class="text-4xl md:text-5xl font-bold mb-4">
            ğŸ¬ ç”µå½±æ¨è
          </h1>
          <p class="text-xl opacity-90 mb-8 max-w-2xl mx-auto">
            é€è¿‡é•œå¤´å®¡è§†æ€§åˆ«è®®é¢˜ï¼Œç”¨å½±åƒè®°å½•å¥³æ€§æ•…äº‹ï¼Œä»¥ç”µå½±æ¿€å‘ç¤¾ä¼šæ€è€ƒ
          </p>
          
          <!-- ç»Ÿè®¡ä¿¡æ¯ -->
          <div class="flex flex-wrap justify-center gap-6 text-sm">
            <div class="flex items-center bg-white/20 backdrop-blur-sm px-4 py-2 rounded-full">
              <span class="mr-2">ğŸï¸</span>
              <span>å…± {totalFilms} éƒ¨ç”µå½±</span>
            </div>
            <div class="flex items-center bg-white/20 backdrop-blur-sm px-4 py-2 rounded-full">
              <span class="mr-2">ğŸŒ</span>
              <span>{allCountries.length} ä¸ªå›½å®¶/åœ°åŒº</span>
            </div>
            <div class="flex items-center bg-white/20 backdrop-blur-sm px-4 py-2 rounded-full">
              <span class="mr-2">ğŸ­</span>
              <span>{allGenres.length} ç§ç±»å‹</span>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Main Content -->
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-12">
      
      <!-- ç­›é€‰åŒºåŸŸ -->
      <div class="mb-12 space-y-6">
        <!-- ä¸»é¢˜æ ‡ç­¾ç­›é€‰ -->
        <div>
          <h2 class="text-xl font-bold text-gray-900 dark:text-white mb-4">ä¸»é¢˜åˆ†ç±»</h2>
          <div class="flex flex-wrap gap-3">
            <button 
              class="filter-btn inline-flex items-center px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition-colors text-sm font-medium"
              data-filter="all"
              data-filter-type="topic"
            >
              å…¨éƒ¨ä¸»é¢˜
            </button>
            {allTopics.map(topic => (
              <button 
                class="filter-btn inline-flex items-center px-4 py-2 bg-white dark:bg-gray-800 border border-gray-300 dark:border-gray-600 text-gray-700 dark:text-gray-300 rounded-lg hover:border-purple-500 dark:hover:border-purple-400 hover:text-purple-600 dark:hover:text-purple-400 transition-colors text-sm"
                data-filter={topic}
                data-filter-type="topic"
              >
                {topic}
              </button>
            ))}
          </div>
        </div>
        
        <!-- å›½å®¶/åœ°åŒºç­›é€‰ -->
        <div>
          <h2 class="text-xl font-bold text-gray-900 dark:text-white mb-4">å›½å®¶/åœ°åŒº</h2>
          <div class="flex flex-wrap gap-3">
            <button 
              class="country-btn inline-flex items-center px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors text-sm font-medium"
              data-country="all"
            >
              å…¨éƒ¨åœ°åŒº
            </button>
            {allCountries.map(country => (
              <button 
                class="country-btn inline-flex items-center px-4 py-2 bg-white dark:bg-gray-800 border border-gray-300 dark:border-gray-600 text-gray-700 dark:text-gray-300 rounded-lg hover:border-blue-500 dark:hover:border-blue-400 hover:text-blue-600 dark:hover:text-blue-400 transition-colors text-sm"
                data-country={country}
              >
                {country}
              </button>
            ))}
          </div>
        </div>
      </div>

      <!-- ç”µå½±ç½‘æ ¼ -->
      <div class="mb-8">
        <div class="flex items-center justify-between mb-6">
          <h2 class="text-2xl font-bold text-gray-900 dark:text-white">
            <span id="current-filter">å…¨éƒ¨ç”µå½±</span>
            <span id="film-count" class="text-base font-normal text-gray-600 dark:text-gray-400 ml-2">
              ({totalFilms} éƒ¨)
            </span>
          </h2>
          <div class="flex items-center gap-4">
            <select id="sort-select" class="px-3 py-2 bg-white dark:bg-gray-800 border border-gray-300 dark:border-gray-600 rounded-lg text-sm text-gray-900 dark:text-white">
              <option value="date-desc">æœ€æ–°ä¸Šæ˜ </option>
              <option value="date-asc">æœ€æ—©ä¸Šæ˜ </option>
              <option value="title-asc">ç‰‡å A-Z</option>
              <option value="title-desc">ç‰‡å Z-A</option>
              <option value="year-desc">å¹´ä»½å€’åº</option>
              <option value="year-asc">å¹´ä»½é¡ºåº</option>
            </select>
          </div>
        </div>
        
        <div id="films-grid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6">
          {currentPageFilms.map(film => (
            <div class="film-item" 
              data-topics={JSON.stringify(film.data.topics)} 
              data-title={film.data.title} 
              data-date={film.data.releaseDate.toISOString()}
              data-country={film.data.country}
              data-year={film.data.year}
            >
              <FilmCard 
                title={film.data.title}
                director={film.data.director}
                description={film.data.description}
                slug={film.slug}
                posterImage={film.data.posterImage}
                releaseDate={film.data.releaseDate}
                topics={film.data.topics}
                year={film.data.year}
                country={film.data.country}
                duration={film.data.duration}
                genre={film.data.genre}
              />
            </div>
          ))}
        </div>
        
        <!-- åˆ†é¡µç»„ä»¶ -->
        {totalPages > 1 && (
          <div class="mt-12 flex justify-center">
            <nav class="flex items-center space-x-2" aria-label="åˆ†é¡µå¯¼èˆª">
              <!-- ä¸Šä¸€é¡µæŒ‰é’® -->
              {validPage > 1 ? (
                <a 
                  href={`/films?page=${validPage - 1}`}
                  class="px-3 py-2 bg-white dark:bg-gray-800 border border-gray-300 dark:border-gray-600 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors"
                  aria-label="ä¸Šä¸€é¡µ"
                >
                  <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path>
                  </svg>
                </a>
              ) : (
                <span class="px-3 py-2 bg-gray-100 dark:bg-gray-900 border border-gray-200 dark:border-gray-700 rounded-lg opacity-50 cursor-not-allowed">
                  <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path>
                  </svg>
                </span>
              )}
              
              <!-- é¡µç æŒ‰é’® -->
              <div class="flex items-center space-x-2">
                {/* ç¬¬ä¸€é¡µ */}
                {validPage === 1 ? (
                  <span class="px-4 py-2 bg-purple-600 text-white rounded-lg font-medium">1</span>
                ) : (
                  <a href="/films?page=1" class="px-4 py-2 bg-white dark:bg-gray-800 border border-gray-300 dark:border-gray-600 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors">1</a>
                )}
                
                {/* å·¦ä¾§çœç•¥å· */}
                {validPage > 3 && <span class="px-2 text-gray-500">...</span>}
                
                {/* ä¸­é—´é¡µç  */}
                {middlePages.map(pageNum => 
                  pageNum === validPage ? (
                    <span class="px-4 py-2 bg-purple-600 text-white rounded-lg font-medium">
                      {pageNum}
                    </span>
                  ) : (
                    <a 
                      href={`/films?page=${pageNum}`}
                      class="px-4 py-2 bg-white dark:bg-gray-800 border border-gray-300 dark:border-gray-600 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors"
                    >
                      {pageNum}
                    </a>
                  )
                )}
                
                {/* å³ä¾§çœç•¥å· */}
                {validPage < totalPages - 2 && <span class="px-2 text-gray-500">...</span>}
                
                {/* æœ€åä¸€é¡µ */}
                {totalPages > 1 && (
                  validPage === totalPages ? (
                    <span class="px-4 py-2 bg-purple-600 text-white rounded-lg font-medium">{totalPages}</span>
                  ) : (
                    <a href={`/films?page=${totalPages}`} class="px-4 py-2 bg-white dark:bg-gray-800 border border-gray-300 dark:border-gray-600 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors">{totalPages}</a>
                  )
                )}
              </div>
              
              <!-- ä¸‹ä¸€é¡µæŒ‰é’® -->
              {validPage < totalPages ? (
                <a 
                  href={`/films?page=${validPage + 1}`}
                  class="px-3 py-2 bg-white dark:bg-gray-800 border border-gray-300 dark:border-gray-600 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors"
                  aria-label="ä¸‹ä¸€é¡µ"
                >
                  <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
                  </svg>
                </a>
              ) : (
                <span class="px-3 py-2 bg-gray-100 dark:bg-gray-900 border border-gray-200 dark:border-gray-700 rounded-lg opacity-50 cursor-not-allowed">
                  <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
                  </svg>
                </span>
              )}
            </nav>
          </div>
        )}
      </div>

      <!-- ç©ºçŠ¶æ€ -->
      {sortedFilms.length === 0 && (
        <div class="text-center py-16">
          <div class="text-6xl mb-4">ğŸ¬</div>
          <h3 class="text-xl font-semibold text-gray-900 dark:text-white mb-2">
            æš‚æ— ç”µå½±å†…å®¹
          </h3>
          <p class="text-gray-600 dark:text-gray-400">
            æˆ‘ä»¬æ­£åœ¨åŠªåŠ›æ·»åŠ æ›´å¤šä¼˜è´¨çš„å¥³æ€§ä¸»ä¹‰ç”µå½±æ¨è
          </p>
        </div>
      )}

      <!-- è§‚å½±æŒ‡å— -->
      <div class="mt-16 bg-gradient-to-r from-purple-50 to-pink-50 dark:from-purple-900/20 dark:to-pink-900/20 rounded-2xl p-8">
        <div class="text-center">
          <h2 class="text-2xl font-bold text-gray-900 dark:text-white mb-4">
            ğŸï¸ è§‚å½±å»ºè®®
          </h2>
          <div class="grid md:grid-cols-3 gap-6 text-left mt-8">
            <div class="bg-white dark:bg-gray-800 rounded-xl p-6 shadow-sm">
              <div class="text-2xl mb-3">ğŸ‘ï¸</div>
              <h3 class="font-semibold text-gray-900 dark:text-white mb-2">æ‰¹åˆ¤æ€§è§‚çœ‹</h3>
              <p class="text-sm text-gray-600 dark:text-gray-400">
                å¸¦ç€æ€§åˆ«è§†è§’å®¡è§†ç”µå½±ä¸­çš„äººç‰©å¡‘é€ ã€å™äº‹æ–¹å¼å’Œä»·å€¼è§‚ä¼ é€’
              </p>
            </div>
            <div class="bg-white dark:bg-gray-800 rounded-xl p-6 shadow-sm">
              <div class="text-2xl mb-3">ğŸ’­</div>
              <h3 class="font-semibold text-gray-900 dark:text-white mb-2">æ·±åº¦æ€è€ƒ</h3>
              <p class="text-sm text-gray-600 dark:text-gray-400">
                è§‚å½±åæ€è€ƒå½±ç‰‡åæ˜ çš„ç¤¾ä¼šè®®é¢˜ï¼Œä¸ç°å®ç”Ÿæ´»å»ºç«‹è”ç³»
              </p>
            </div>
            <div class="bg-white dark:bg-gray-800 rounded-xl p-6 shadow-sm">
              <div class="text-2xl mb-3">ğŸ’¬</div>
              <h3 class="font-semibold text-gray-900 dark:text-white mb-2">äº¤æµè®¨è®º</h3>
              <p class="text-sm text-gray-600 dark:text-gray-400">
                ä¸æœ‹å‹åˆ†äº«è§‚å½±æ„Ÿå—ï¼Œåœ¨è®¨è®ºä¸­ç¢°æ’æ€æƒ³ï¼Œæ·±åŒ–ç†è§£
              </p>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</Layout>

<script>
  document.addEventListener('DOMContentLoaded', function() {
    const filterButtons = document.querySelectorAll('.filter-btn');
    const countryButtons = document.querySelectorAll('.country-btn');
    const sortSelect = document.getElementById('sort-select');
    const filmsGrid = document.getElementById('films-grid');
    const currentFilter = document.getElementById('current-filter');
    const filmCount = document.getElementById('film-count');
    
    let currentTopic = 'all';
    let currentCountry = 'all';
    const FILMS_PER_PAGE = 12;
    let currentPage = 1;
    let allFilmItems = [];
    
    // ä¿å­˜æ‰€æœ‰ç”µå½±é¡¹ç›®
    allFilmItems = Array.from(document.querySelectorAll('.film-item')).map(item => {
      return {
        element: item.cloneNode(true),
        topics: JSON.parse(item.dataset.topics),
        title: item.dataset.title,
        date: item.dataset.date,
        country: item.dataset.country,
        year: parseInt(item.dataset.year)
      };
    });
    
    // ä¸»é¢˜ç­›é€‰åŠŸèƒ½
    filterButtons.forEach(button => {
      button.addEventListener('click', function() {
        const filterValue = this.dataset.filter;
        currentTopic = filterValue;
        currentPage = 1;
        
        // æ›´æ–°æŒ‰é’®æ ·å¼
        filterButtons.forEach(btn => {
          btn.classList.remove('bg-purple-600', 'text-white');
          btn.classList.add('bg-white', 'dark:bg-gray-800', 'border', 'border-gray-300', 'dark:border-gray-600', 'text-gray-700', 'dark:text-gray-300');
        });
        
        this.classList.remove('bg-white', 'dark:bg-gray-800', 'border', 'border-gray-300', 'dark:border-gray-600', 'text-gray-700', 'dark:text-gray-300');
        this.classList.add('bg-purple-600', 'text-white');
        
        updateFilterTitle();
        filterAndSort();
      });
    });
    
    // å›½å®¶/åœ°åŒºç­›é€‰åŠŸèƒ½
    countryButtons.forEach(button => {
      button.addEventListener('click', function() {
        const countryValue = this.dataset.country;
        currentCountry = countryValue;
        currentPage = 1;
        
        // æ›´æ–°æŒ‰é’®æ ·å¼
        countryButtons.forEach(btn => {
          btn.classList.remove('bg-blue-600', 'text-white');
          btn.classList.add('bg-white', 'dark:bg-gray-800', 'border', 'border-gray-300', 'dark:border-gray-600', 'text-gray-700', 'dark:text-gray-300');
        });
        
        this.classList.remove('bg-white', 'dark:bg-gray-800', 'border', 'border-gray-300', 'dark:border-gray-600', 'text-gray-700', 'dark:text-gray-300');
        this.classList.add('bg-blue-600', 'text-white');
        
        updateFilterTitle();
        filterAndSort();
      });
    });
    
    // æ’åºåŠŸèƒ½
    sortSelect.addEventListener('change', function() {
      currentPage = 1;
      filterAndSort();
    });
    
    function updateFilterTitle() {
      let title = '';
      if (currentTopic !== 'all' && currentCountry !== 'all') {
        title = `${currentTopic} Â· ${currentCountry}`;
      } else if (currentTopic !== 'all') {
        title = currentTopic;
      } else if (currentCountry !== 'all') {
        title = currentCountry;
      } else {
        title = 'å…¨éƒ¨ç”µå½±';
      }
      currentFilter.textContent = title;
    }
    
    function filterAndSort() {
      const sortValue = sortSelect.value;
      
      // ç­›é€‰
      let filteredFilms = allFilmItems.filter(item => {
        const topicMatch = currentTopic === 'all' || item.topics.includes(currentTopic);
        const countryMatch = currentCountry === 'all' || item.country === currentCountry;
        return topicMatch && countryMatch;
      });
      
      // æ’åº
      filteredFilms.sort((a, b) => {
        switch (sortValue) {
          case 'date-desc':
            return new Date(b.date).getTime() - new Date(a.date).getTime();
          case 'date-asc':
            return new Date(a.date).getTime() - new Date(b.date).getTime();
          case 'title-asc':
            return a.title.localeCompare(b.title);
          case 'title-desc':
            return b.title.localeCompare(a.title);
          case 'year-desc':
            return b.year - a.year;
          case 'year-asc':
            return a.year - b.year;
          default:
            return 0;
        }
      });
      
      // æ¸…ç©ºç½‘æ ¼
      filmsGrid.innerHTML = '';
      
      // è®¡ç®—åˆ†é¡µ
      const totalFiltered = filteredFilms.length;
      const totalPages = Math.ceil(totalFiltered / FILMS_PER_PAGE);
      const startIndex = (currentPage - 1) * FILMS_PER_PAGE;
      const endIndex = startIndex + FILMS_PER_PAGE;
      const currentPageFilms = filteredFilms.slice(startIndex, endIndex);
      
      // æ˜¾ç¤ºå½“å‰é¡µçš„ç”µå½±
      currentPageFilms.forEach(item => {
        filmsGrid.appendChild(item.element.cloneNode(true));
      });
      
      // æ›´æ–°è®¡æ•°
      filmCount.textContent = `(${totalFiltered} éƒ¨)`;
      
      // åˆ›å»ºæˆ–æ›´æ–°åˆ†é¡µæ§ä»¶
      updatePagination(totalPages, totalFiltered);
      
      // å¦‚æœæ²¡æœ‰ç»“æœï¼Œæ˜¾ç¤ºç©ºçŠ¶æ€
      if (filteredFilms.length === 0) {
        const emptyDiv = document.createElement('div');
        emptyDiv.id = 'empty-state';
        emptyDiv.className = 'col-span-full text-center py-16';
        emptyDiv.innerHTML = `
          <div class="text-6xl mb-6">ğŸ¬</div>
          <h3 class="text-2xl font-bold text-gray-900 dark:text-white mb-4">
            æš‚æ— ç›¸å…³ç”µå½±
          </h3>
          <p class="text-gray-600 dark:text-gray-400">
            è¯¥ç­›é€‰æ¡ä»¶ä¸‹æš‚æ— ç”µå½±ï¼Œè¯•è¯•å…¶ä»–æ¡ä»¶æˆ–æŸ¥çœ‹å…¨éƒ¨ç”µå½±
          </p>
        `;
        filmsGrid.appendChild(emptyDiv);
      }
    }
    
    function updatePagination(totalPages, totalItems) {
      // ç§»é™¤ç°æœ‰çš„åˆ†é¡µæ§ä»¶
      const existingPagination = document.getElementById('filter-pagination');
      if (existingPagination) {
        existingPagination.remove();
      }
      
      // å¦‚æœæ€»é¡µæ•°å¤§äº1ï¼Œæ·»åŠ åˆ†é¡µæ§ä»¶
      if (totalPages > 1) {
        const paginationHTML = `
          <div id="filter-pagination" class="mt-12 flex justify-center">
            <nav class="flex items-center space-x-2" aria-label="åˆ†é¡µå¯¼èˆª">
              <button 
                class="pagination-prev px-3 py-2 ${currentPage > 1 ? 'bg-white dark:bg-gray-800 border border-gray-300 dark:border-gray-600 hover:bg-gray-50 dark:hover:bg-gray-700' : 'bg-gray-100 dark:bg-gray-900 border border-gray-200 dark:border-gray-700 opacity-50 cursor-not-allowed'} rounded-lg transition-colors"
                ${currentPage <= 1 ? 'disabled' : ''}
              >
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path>
                </svg>
              </button>
              
              <div class="flex items-center space-x-2" id="page-numbers">
                ${generatePageNumbers(totalPages)}
              </div>
              
              <button 
                class="pagination-next px-3 py-2 ${currentPage < totalPages ? 'bg-white dark:bg-gray-800 border border-gray-300 dark:border-gray-600 hover:bg-gray-50 dark:hover:bg-gray-700' : 'bg-gray-100 dark:bg-gray-900 border border-gray-200 dark:border-gray-700 opacity-50 cursor-not-allowed'} rounded-lg transition-colors"
                ${currentPage >= totalPages ? 'disabled' : ''}
              >
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
                </svg>
              </button>
            </nav>
          </div>
        `;
        
        filmsGrid.insertAdjacentHTML('afterend', paginationHTML);
        
        // æ·»åŠ åˆ†é¡µäº‹ä»¶ç›‘å¬å™¨
        document.querySelector('.pagination-prev')?.addEventListener('click', () => {
          if (currentPage > 1) {
            currentPage--;
            filterAndSort();
          }
        });
        
        document.querySelector('.pagination-next')?.addEventListener('click', () => {
          if (currentPage < totalPages) {
            currentPage++;
            filterAndSort();
          }
        });
        
        document.querySelectorAll('.page-number').forEach(btn => {
          btn.addEventListener('click', function() {
            currentPage = parseInt(this.dataset.page);
            filterAndSort();
          });
        });
      }
    }
    
    function generatePageNumbers(totalPages) {
      let html = '';
      for (let i = 1; i <= totalPages; i++) {
        const showPage = i === 1 || 
                        i === totalPages || 
                        Math.abs(i - currentPage) <= 1;
        
        if (showPage) {
          if (i === currentPage) {
            html += `<span class="px-4 py-2 bg-purple-600 text-white rounded-lg font-medium">${i}</span>`;
          } else {
            html += `<button class="page-number px-4 py-2 bg-white dark:bg-gray-800 border border-gray-300 dark:border-gray-600 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors" data-page="${i}">${i}</button>`;
          }
        } else if (i === 2 && currentPage > 4) {
          html += `<span class="px-2 text-gray-500">...</span>`;
        } else if (i === totalPages - 1 && currentPage < totalPages - 3) {
          html += `<span class="px-2 text-gray-500">...</span>`;
        }
      }
      return html;
    }
  });
</script>