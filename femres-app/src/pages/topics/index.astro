---
import Layout from '../../layouts/Layout.astro';
import { getCollection } from 'astro:content';
import { findTopicByName, getTopicIcon } from '../../i18n/topicsUtils';

// è·å–æ‰€æœ‰å†…å®¹ä»¥ç»Ÿè®¡ä¸»é¢˜
const books = await getCollection('books');
const articles = await getCollection('articles');
const videos = await getCollection('videos');
const podcasts = await getCollection('podcasts');
const papers = await getCollection('papers');

const allContent = [
  ...books.map(item => ({ ...item, contentType: 'book' as const })),
  ...articles.map(item => ({ ...item, contentType: 'article' as const })),
  ...videos.map(item => ({ ...item, contentType: 'video' as const })),
  ...podcasts.map(item => ({ ...item, contentType: 'podcast' as const })),
  ...papers.map(item => ({ ...item, contentType: 'paper' as const }))
];

// ç»Ÿè®¡æ¯ä¸ªä¸»é¢˜çš„å†…å®¹æ•°é‡
const topicCounts = allContent.reduce((acc, item) => {
  item.data.topics.forEach(topic => {
    acc[topic] = (acc[topic] || 0) + 1;
  });
  return acc;
}, {} as Record<string, number>);

// ä¸»é¢˜åˆ†ç±»å®šä¹‰
const topicCategories = {
  'ç†è®ºæµæ´¾': {
    topics: [
      'äº¤å‰å¥³æ€§ä¸»ä¹‰',
      'é©¬å…‹æ€ä¸»ä¹‰å¥³æ€§ä¸»ä¹‰', 
      'å»æ®–æ°‘å¥³æ€§ä¸»ä¹‰',
      'å­˜åœ¨ä¸»ä¹‰å¥³æ€§ä¸»ä¹‰',
      'è‡ªç”±ä¸»ä¹‰å¥³æ€§ä¸»ä¹‰',
      'æ¿€è¿›å¥³æ€§ä¸»ä¹‰',
      'é»‘äººå¥³æ€§ä¸»ä¹‰',
      'åŸä½æ°‘å¥³æ€§ä¸»ä¹‰',
      'è·¨æ€§åˆ«å¥³æ€§ä¸»ä¹‰',
      'ç”Ÿæ€å¥³æ€§ä¸»ä¹‰',
      'åç°ä»£å¥³æ€§ä¸»ä¹‰'
    ],
    icon: 'ğŸ§©',
    description: 'å¥³æ€§ä¸»ä¹‰çš„ç†è®ºå­¦æ´¾å’Œæ€æƒ³æµæ´¾'
  },
  'è¿åŠ¨è®®é¢˜': {
    topics: [
      'èŒåœºå¹³ç­‰',
      'åŒå·¥åŒé…¬',
      'ç»ç’ƒå¤©èŠ±æ¿',
      'ç”Ÿè‚²è‡ªä¸»',
      'å •èƒæƒ',
      'åæ€§æš´åŠ›',
      'æ”¿æ²»å‚ä¸',
      'æ³•å¾‹å¹³ç­‰',
      'ç»æµèµ‹æƒ',
      'æ•™è‚²å¹³ç­‰',
      'å®¶åº­è§£æ”¾',
      'ä½“è‚²å¹³ç­‰',
      'èº«ä½“è‡ªä¸»',
      'æ•°å­—å¥³æ€§ä¸»ä¹‰',
      'æ°”å€™æ­£ä¹‰'
    ],
    icon: 'âœŠ',
    description: 'å¥³æ€§ä¸»ä¹‰å…³æ³¨çš„å…·ä½“ç¤¾ä¼šè®®é¢˜'
  },
  'æ‰¹åˆ¤é¢†åŸŸ': {
    topics: [
      'çˆ¶æƒåˆ¶æ‰¹åˆ¤',
      'èµ„æœ¬ä¸»ä¹‰æ‰¹åˆ¤',
      'åª’ä½“è¡¨å¾æ‰¹åˆ¤',
      'å®—æ•™çˆ¶æƒæ‰¹åˆ¤',
      'ç”·æƒè¿åŠ¨æ‰¹åˆ¤',
      'æ–‡åŒ–æ‰¹åˆ¤',
      'åå¥³æ€§ä¸»ä¹‰ç ”ç©¶',
      'å­¦æœ¯çˆ¶æƒæ‰¹åˆ¤',
      'è¯­è¨€æ€§åˆ«æ­§è§†',
      'ç¿»è¯‘æ”¿æ²»',
      'çŸ¥è¯†æ®–æ°‘æ‰¹åˆ¤'
    ],
    icon: 'ğŸ”',
    description: 'å¥³æ€§ä¸»ä¹‰æ‰¹åˆ¤å’Œåˆ†æçš„é‡ç‚¹é¢†åŸŸ'
  },
  'å†å²è„‰ç»œ': {
    topics: [
      'ç¬¬ä¸€æ³¢å¥³æ€§ä¸»ä¹‰',
      'ç¬¬äºŒæ³¢å¥³æ€§ä¸»ä¹‰',
      'ç¬¬ä¸‰æ³¢å¥³æ€§ä¸»ä¹‰',
      'ç¬¬å››æ³¢å¥³æ€§ä¸»ä¹‰',
      'MeTooè¿åŠ¨',
      'ä¸­å›½å¥³æƒè¿åŠ¨',
      'æµè¡Œæ–‡åŒ–å¥³æ€§ä¸»ä¹‰',
      'åŸºç£æ•™å¥³æ€§ä¸»ä¹‰',
      'çµæ€§å¥³æ€§ä¸»ä¹‰'
    ],
    icon: 'ğŸ“š',
    description: 'å¥³æ€§ä¸»ä¹‰çš„å†å²å‘å±•å’Œæ—¶ä»£èƒŒæ™¯'
  },
  'æ–‡å­¦ä¸åˆ›ä½œ': {
    topics: [
      'å¥³æ€§æ–‡å­¦',
      'å¥³æ€§å†™ä½œ',
      'å¥³æ€§æ–‡å­¦æ‰¹è¯„',
      'ç¿»è¯‘å¥³æ€§ä¸»ä¹‰',
      'å¥³æ€§å™äº‹å­¦'
    ],
    icon: 'âœï¸',
    description: 'å¥³æ€§ä¸»ä¹‰æ–‡å­¦ç†è®ºä¸åˆ›ä½œå®è·µ'
  },
  'ç‰¹æ®Šæ¦‚å¿µ': {
    topics: [
      'æƒ…ç»ªåŠ³åŠ¨',
      'å…³æ€€ä¼¦ç†',
      'å¥³æ€§ä¸»ä¹‰å¿ƒç†å­¦',
      'å¥³æ€§ä¸»ä¹‰è‰ºæœ¯',
      'ç§æ—ä¸æ€§åˆ«',
      'æ¯å¥³å…³ç³»',
      'å¥³æ€§å‹è°Š',
      'é…·å„¿èº«ä»½',
      'ç§»æ°‘èº«ä»½è®¤åŒ',
      'æ–‡åŒ–è®¤åŒ'
    ],
    icon: 'ğŸ’¡',
    description: 'å¥³æ€§ä¸»ä¹‰ç‹¬ç‰¹çš„æ¦‚å¿µå’Œç†è®º'
  }
};

// ä¸ºæ¯ä¸ªåˆ†ç±»æ·»åŠ ç»Ÿè®¡æ•°æ®
const enrichedCategories = Object.entries(topicCategories).map(([categoryName, category]) => ({
  name: categoryName,
  ...category,
  totalContent: category.topics.reduce((sum, topic) => {
    const topicInfo = findTopicByName(topic);
    const englishName = topicInfo?.enName || topic;
    return sum + (topicCounts[englishName] || 0);
  }, 0),
  topics: category.topics.map(topic => {
    // topic æ˜¯ä¸­æ–‡åï¼Œéœ€è¦æ‰¾åˆ°å¯¹åº”çš„è‹±æ–‡åæ¥ç»Ÿè®¡
    const topicInfo = findTopicByName(topic);
    const englishName = topicInfo?.enName || topic;
    return {
      englishName: englishName,
      chineseName: topic,
      count: topicCounts[englishName] || 0,
      icon: topicInfo?.icon || 'ğŸ“‹'
    };
  })
}));

// è·å–çƒ­é—¨ä¸»é¢˜ï¼ˆæŒ‰å†…å®¹æ•°é‡æ’åºï¼‰
const popularTopics = Object.entries(topicCounts)
  .sort((a, b) => b[1] - a[1])
  .slice(0, 12)
  .map(([topic, count]) => {
    const topicInfo = findTopicByName(topic);
    return {
      englishName: topic,
      chineseName: topicInfo?.zhName || topic,
      count,
      icon: topicInfo?.icon || 'ğŸ“‹'
    };
  });
---

<Layout 
  title="ä¸»é¢˜åˆ†ç±» - FemRes" 
  description="æ¢ç´¢å¥³æ€§ä¸»ä¹‰çš„å„ä¸ªä¸»é¢˜åˆ†ç±»ï¼ŒåŒ…æ‹¬ç†è®ºæµæ´¾ã€è¿åŠ¨è®®é¢˜ã€æ‰¹åˆ¤é¢†åŸŸç­‰"
>
  <!-- Hero Section -->
  <section class="relative py-12 sm:py-16 lg:py-20 overflow-hidden">
    <!-- Background decorative elements -->
    <div class="absolute inset-0 -z-10">
      <div class="absolute top-20 left-20 w-32 sm:w-48 lg:w-72 h-32 sm:h-48 lg:h-72 bg-purple-300 rounded-full mix-blend-multiply filter blur-xl opacity-20 animate-blob"></div>
      <div class="absolute top-10 right-10 w-32 sm:w-48 lg:w-72 h-32 sm:h-48 lg:h-72 bg-pink-300 rounded-full mix-blend-multiply filter blur-xl opacity-20 animate-blob animation-delay-2000"></div>
      <div class="absolute bottom-20 left-1/3 w-32 sm:w-48 lg:w-72 h-32 sm:h-48 lg:h-72 bg-indigo-300 rounded-full mix-blend-multiply filter blur-xl opacity-20 animate-blob animation-delay-4000"></div>
    </div>

    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
      <div class="text-center">
        <h1 class="text-3xl sm:text-4xl md:text-5xl lg:text-6xl font-bold text-gray-900 dark:text-white mb-4 sm:mb-6">
          å¥³æ€§ä¸»ä¹‰
          <span class="text-transparent bg-clip-text bg-gradient-to-r from-purple-600 to-pink-600">ä¸»é¢˜åˆ†ç±»</span>
        </h1>
        <p class="text-lg sm:text-xl md:text-2xl text-gray-600 dark:text-gray-300 max-w-3xl mx-auto px-4">
          æ·±å…¥äº†è§£å¥³æ€§ä¸»ä¹‰çš„ä¸°å¯Œå†…å®¹ï¼Œä»ç†è®ºæµæ´¾åˆ°è¿åŠ¨å®è·µ
        </p>
      </div>
    </div>
  </section>

  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8 sm:py-12">
    
    <!-- Popular Topics -->
    <section class="mb-16 sm:mb-20">
      <div class="text-center mb-12">
        <h2 class="text-2xl sm:text-3xl md:text-4xl font-bold text-gray-900 dark:text-white mb-4">
          çƒ­é—¨ä¸»é¢˜
        </h2>
        <p class="text-lg sm:text-xl text-gray-600 dark:text-gray-300 max-w-2xl mx-auto">
          æœ€å—å…³æ³¨çš„å¥³æ€§ä¸»ä¹‰è¯é¢˜
        </p>
      </div>

      <div class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4 sm:gap-6">
        {popularTopics.map((topic) => (
          <a
            href={`/topics/${topic.englishName}`}
            class="group bg-white dark:bg-gray-800 rounded-2xl p-6 border border-gray-200 dark:border-gray-700 hover:shadow-xl hover:border-purple-300 dark:hover:border-purple-600 transition-all duration-300 hover:-translate-y-1"
          >
            <div class="text-center">
              <div class="text-4xl mb-3">
                {topic.icon}
              </div>
              <h3 class="font-semibold text-gray-900 dark:text-white mb-2 group-hover:text-purple-600 dark:group-hover:text-purple-400 transition-colors">
                {topic.chineseName}
              </h3>
              <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-purple-100 dark:bg-purple-900 text-purple-800 dark:text-purple-200">
                {topic.count} ä¸ªå†…å®¹
              </span>
            </div>
          </a>
        ))}
      </div>
    </section>

    <!-- Topic Categories -->
    {enrichedCategories.map(category => (
      <section class="mb-16 sm:mb-20">
        <div class="flex items-center mb-8">
          <div class="flex items-center">
            <span class="text-3xl mr-4">
              {category.icon}
            </span>
            <h2 class="text-2xl sm:text-3xl font-bold text-gray-900 dark:text-white">
              {category.name}
            </h2>
            <span class="ml-4 px-3 py-1 text-sm bg-gray-100 dark:bg-gray-700 text-gray-600 dark:text-gray-400 rounded-full">
              {category.topics.filter(topic => topic.count > 0).length} ä¸ªä¸»é¢˜
            </span>
          </div>
        </div>

        <div class="mb-4 p-4 bg-gradient-to-r from-purple-50 to-pink-50 dark:from-purple-900/20 dark:to-pink-900/20 rounded-xl">
          <p class="text-gray-700 dark:text-gray-300 mb-2">{category.description}</p>
          <div class="flex items-center text-sm text-purple-600 dark:text-purple-400">
            <span class="font-semibold">æ€»å†…å®¹æ•°é‡ï¼š{category.totalContent}</span>
          </div>
        </div>

        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4 sm:gap-6">
          {category.topics.map(topic => (
            <div class="group">
              {topic.count > 0 ? (
                <a
                  href={`/topics/${topic.englishName}`}
                  class="block bg-white dark:bg-gray-800 rounded-xl p-5 border border-gray-200 dark:border-gray-700 hover:shadow-lg hover:border-purple-300 dark:hover:border-purple-600 transition-all duration-200 hover:-translate-y-0.5"
                >
                  <div class="flex items-center">
                    <span class="text-2xl mr-3">
                      {topic.icon}
                    </span>
                    <div class="flex-1 min-w-0">
                      <h3 class="font-medium text-gray-900 dark:text-white group-hover:text-purple-600 dark:group-hover:text-purple-400 transition-colors truncate">
                        {topic.chineseName}
                      </h3>
                      <span class="text-sm text-gray-500 dark:text-gray-400">
                        {topic.count} ä¸ªå†…å®¹
                      </span>
                    </div>
                  </div>
                </a>
              ) : (
                <div class="bg-gray-50 dark:bg-gray-900 rounded-xl p-5 border border-gray-200 dark:border-gray-700 opacity-60">
                  <div class="flex items-center">
                    <span class="text-2xl mr-3 grayscale">
                      {topic.icon}
                    </span>
                    <div class="flex-1 min-w-0">
                      <h3 class="font-medium text-gray-500 dark:text-gray-400 truncate">
                        {topic.chineseName}
                      </h3>
                      <span class="text-sm text-gray-400 dark:text-gray-500">
                        å³å°†æ¨å‡º
                      </span>
                    </div>
                  </div>
                </div>
              )}
            </div>
          ))}
        </div>
      </section>
    ))}

    <!-- Call to Action -->
    <section class="text-center">
      <div class="bg-gradient-to-br from-purple-50 to-pink-50 dark:from-gray-800 dark:to-gray-900 rounded-3xl p-8 sm:p-12">
        <h2 class="text-2xl sm:text-3xl md:text-4xl font-bold text-gray-900 dark:text-white mb-4">
          è´¡çŒ®æ–°å†…å®¹
        </h2>
        <p class="text-lg sm:text-xl text-gray-600 dark:text-gray-300 mb-8 max-w-2xl mx-auto">
          å¦‚æœæ‚¨æœ‰ä¼˜è´¨çš„å¥³æ€§ä¸»ä¹‰ç›¸å…³å†…å®¹ï¼Œæ¬¢è¿ä¸æˆ‘ä»¬åˆ†äº«
        </p>
        <div class="flex flex-col sm:flex-row gap-4 justify-center">
          <a 
            href="/contribute"
            class="inline-flex items-center justify-center px-8 py-4 bg-gradient-to-r from-purple-600 to-pink-600 hover:from-purple-700 hover:to-pink-700 text-white font-semibold rounded-xl shadow-lg hover:shadow-xl transform hover:-translate-y-1 transition-all duration-200"
          >
            æäº¤å†…å®¹
            <svg class="ml-2 w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"></path>
            </svg>
          </a>
          <a 
            href="/search"
            class="inline-flex items-center justify-center px-8 py-4 border border-purple-600 text-purple-600 dark:text-purple-400 hover:bg-purple-50 dark:hover:bg-purple-900/20 font-semibold rounded-xl transition-all duration-200"
          >
            æœç´¢å†…å®¹
            <svg class="ml-2 w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
            </svg>
          </a>
        </div>
      </div>
    </section>
  </div>

  <style>
    @keyframes blob {
      0% { transform: translate(0px, 0px) scale(1); }
      33% { transform: translate(30px, -50px) scale(1.1); }
      66% { transform: translate(-20px, 20px) scale(0.9); }
      100% { transform: translate(0px, 0px) scale(1); }
    }
    .animate-blob {
      animation: blob 7s infinite;
    }
    .animation-delay-2000 {
      animation-delay: 2s;
    }
    .animation-delay-4000 {
      animation-delay: 4s;
    }
  </style>
</Layout>